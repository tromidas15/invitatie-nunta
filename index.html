<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nunta Mihai si Andra</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Garamond', serif;
      background: #fdf7f2;
      color: black;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      min-height: 100vh;
    }
    header {
      width: 100%;
      background: #a0785a;
      color: #ffffff;
      padding: 20px 0;
      text-align: center;
      position: fixed;
      top: 0;
      z-index: 1000;
    }
    header img {
      max-width: 100px;
      border-radius: 50%;
      margin-bottom: 10px;
    }
    header h1 {
      font-size: 2rem;
      margin: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0.5; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    /* Navigation Menu */
    .menu {
      position: sticky;
      top: 0;
      left: 0;
      background: #ffffff;
      display: flex;
      border: 1px solid #e7d5c4;
      border-radius: 5px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      padding: 10px;
      z-index: 999;
      width: 100%;
      justify-content: flex-end;
    }
    .menu a {
      color: #5a3c2e;
      text-decoration: none;
      font-size: 1rem;
      margin-left: 10px;
      margin-right: 10px;
      transition: color 0.3s ease;
    }
    .menu a:hover {
      color: #a0785a;
    }

    /* Hero Section */
    .head {
      width: 100%;
      min-height: 100vh;
      background-image: url('images/bg-image.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.9;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .head h1 {
      font: 400 60px Sofia, Arial;
      text-transform: none;
      line-height: 1.125;
      margin: 20px 0;
      color: #fff;
    }

    /* Middle Section */
    .mid {
      width: 100%;
      padding: 5vh 10px;
      background-image: url('images/bg-image-mid.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.9;
    }
    .mid p {
      margin: 10px 0;
      font-size: 1.2rem;
    }

    /* Info Container */
    .info-container {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap; /* Allow wrapping on smaller screens */
      gap: 20px;
      margin-top: 3rem;
      padding-left: 70px;
      padding-right: 30px;
    }
    .info-box {
      flex: 1 1 250px;  /* Grow/shrink and set a min width */
      border-right: 1px solid black;
      min-height: 300px;
      padding: 20px;
      box-sizing: border-box;
    }
    .info-box:last-child {
      border-right: none; /* remove right border on last box */
    }
    .info-box img {
      max-width: 100px;
      height: auto;
    }

    /* Invitation Card */
    .invitation-card {
      max-width: 600px;
      width: 90%;
      padding: 40px 20px;
      border: 1px solid #e7d5c4;
      border-radius: 10px;
      background: #ffffff;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      margin: 20px auto;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: #fff; /* Overridden in .head for the hero text */
    }
    h2 {
      font-size: 1.8rem;
      color: #5a3c2e;
      margin-bottom: 20px;
    }
    p {
      font-size: 1.2rem;
      margin: 10px 0;
    }
    .decorative-line {
      width: 100%;
      height: 2px;
      background: #e7d5c4;
      margin: 20px auto;
    }

    /* Buttons */
    .button-container {
      margin-top: 20px;
    }
    .button {
      padding: 15px 30px;
      font-size: 1rem;
      font-family: 'Garamond', serif;
      background: #a0785a;
      color: #ffffff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px;
      transition: background 0.3s ease;
    }
    .button:hover {
      background: #8b634d;
    }

    /* RSVP Message */
    .rsvp-message {
      font-size: 1.1rem;
      margin-top: 20px;
      font-style: italic;
    }
    .footer {
      margin-top: 30px;
      font-size: 0.9rem;
      color: #a0785a;
    }

    /* Loading Overlay */
    #loadingOverlay {
      display: none;          /* hidden by default */
      position: fixed;
      z-index: 9999;          /* topmost layer */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8); /* semi-transparent */
      align-items: center;
      justify-content: center;
    }
    /* Simple Spinner (you can replace it with any spinner you like) */
    .spinner {
      width: 64px;
      height: 64px;
      border: 6px solid #ccc;
      border-top: 6px solid #a0785a;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive media queries */
    @media (max-width: 868px) {
      .head {
        background-attachment: scroll; /* fixed can be problematic on mobile */
      }
      .info-container {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap; /* Allow wrapping on smaller screens */
      gap: 20px;
      margin-top: 3rem;
      padding-left: 0;
      padding-right: 0;
    }
      .mid {
        width: 100%;
        padding: 5vh 10px;
        background-image: url('images/bg-responsive.jpg');
        background-size: cover;
        background-position: center;
        background-attachment: scroll;
        opacity: 0.9;
      }
      .info-box {
        border-right: none;
        border-bottom: 1px solid black;
        min-height: auto;
      }
      .info-box:last-child {
        border-bottom: none;
      }
    }
    /* Style for text and number inputs */
input[type="text"],
input[type="number"] {
  font-size: 1rem;
  font-family: 'Garamond', serif;
  color: #5a3c2e;
  background-color: #fdf7f2;
  border: 1px solid #a0785a;
  border-radius: 5px;
  padding: 10px;
  margin: 8px 0;
  width: 80%;
  box-sizing: border-box; /* ensures padding doesn't affect total width */
}

input[type="text"]:focus,
input[type="number"]:focus {
  outline: none;
  border-color: #8b634d;
  box-shadow: 0 0 3px rgba(139, 99, 77, 0.3);
}
  </style>
</head>
<body>

  <!-- Loading Overlay -->
  <div id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <!-- Menu -->
  <nav class="menu">
    <a href="#cand">Cand ?</a>
    <a href="#unde">Unde ?</a>
    <a href="#confirma">Confirma</a>
  </nav>

  <!-- Hero Section -->
  <div class="head">
    <h1>Nunta Mihai si Andrada</h1>
  </div>

  <!-- Middle Section -->
  <div class="mid">
    <p>Pentru că viața e mai frumoasă în doi, noi,</p>
    <p>Mihai & Andrada</p>
    <p>Sub privirile emoționate ale părințiilor,</p>
    <div style="display: flex; justify-content: space-evenly; flex-wrap: wrap;">
      <p>Marius & Luciana Traoca</p>
      <p>Marcel & Lucica Olteanu</p>
    </div>
    <p>Și însoțiți în acest început de drum de dragii noștri nași,</p>
    <p>Nardy & Cristina Roșu</p>
    <p>Vă invităm să luați parte la celebrarea căsătoriei noastre</p>

    <div class="info-container">
      <div class="info-box">
        <h2 id="cand">Vă așteptăm pe data de 7 Iunie 2025</h2>
        <div id="countdown"></div>
      </div>
      <div class="info-box">
        <img src="images/church-svgrepo-com.svg" alt="church" width="65">
        <p>Biserica Sfântul Ierarh Calinic</p>
        <p>Ora 13:00</p>
        <a href="https://maps.app.goo.gl/rigUtzsbtyBGPKx16">
          <button class="button">Deschide locatia</button>
        </a>
      </div>

      <div class="info-box">
        <img src="images/champaign.svg" alt="champagne" width="95">
        <p>Restaurant Ambasador Garden Back</p>
        <p>Ora 19:00</p>
        <a href="https://g.co/kgs/inS4RuR">
          <button class="button">Deschide locatia</button>
        </a>
      </div>
    </div>
  </div>

  <!-- Invitation Card -->
  <div class="invitation-card">
    <div class="decorative-line"></div>
    <h2 id="unde">Nunta lui</h2>
    <p><strong>Olteanu Andrada</strong> &amp; <strong>Troaca Mihai Dan</strong></p>
    <p>Pe data de <strong>07.06.2025</strong></p>
    <p>La <strong>Ambasador Garden</strong></p>
    <div class="decorative-line"></div>

    <div class="button-container" id="confirma">
      <div>Vă rugăm să confimrați prezența pană la data de: 18 Mai 2025</div>
      <br/>
      <div>Nume</div>
      <input id="name" type="text" />
      <div>Număr de persoane</div>
      <input id="number" type="number" />
      <br/>
      <button class="button" onclick="submitRSVP()">Confirma</button>
    </div>

    <div id="status-msg" class="rsvp-message"></div>
  </div>

  <script>
    // ------- 1) URLs: -------
    // The Apps Script that will be used to read existing data by IP
    const APPS_SCRIPT_URL_get_by_ip = "https://script.google.com/macros/s/AKfycbxBndQk8exCBMT4n-CzjFxAOu-g3ZmTCb4D6Yw1e1roGt2sXr19pbkMNdyYmna6EKCp/exec";

    // The Apps Script that will insert/update row by IP
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyX5Ddkw3mBBXmRHm1zFd0LXJ0FIyJKxPe1wq4ix2cN2b4zo-CbMyeppdClg7KCnTQn/exec";

    // HTML references
    const statusMsg = document.getElementById('status-msg');
    const nameInput = document.getElementById('name');
    const numberInput = document.getElementById('number');

    // Loading overlay references
    const loadingOverlay = document.getElementById('loadingOverlay');

    let userIp = "";

    // Show/hide loading overlay
    function showLoading() {
      loadingOverlay.style.display = 'flex';  // flex so spinner stays centered
    }
    function hideLoading() {
      loadingOverlay.style.display = 'none';
    }

    // ------- 2) On load: fetch client IP ------
    showLoading(); // start loading as soon as possible
    fetch("https://api.ipify.org?format=json")
      .then(res => res.json())
      .then(data => {
        userIp = data.ip || "";
        // After IP is fetched, check if we already have data for that IP
        checkExistingData(userIp);
      })
      .catch(err => {
        console.warn("Could not get IP:", err.message);
        hideLoading();
      });

    function checkExistingData(ip) {
      if( localStorage.getItem('old_ip')){
        ip = localStorage.getItem('old_ip')
      }

      if (!ip) {
        hideLoading();
        return;
      }
      const url = `${APPS_SCRIPT_URL_get_by_ip}?ip=${encodeURIComponent(ip)}`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.success && data.rows.length > 0) {
            let row = data.rows[0];
            nameInput.value = row.name || "";
            numberInput.value = row.number || "";
          } 
          // If success = false or no row found, we do nothing special
        })
        .catch(err => {
          console.error("Error fetching existing IP data:", err);
        })
        .finally(() => {
          hideLoading(); // hide spinner regardless of success or failure
        });
    }

    // ------- 4) submitRSVP: calls APPS_SCRIPT_URL for insert/update by IP ------
    function submitRSVP() {
      let nameValue = nameInput.value.trim();
      let numberValue = numberInput.value.trim();

      if (!nameValue) {
        statusMsg.innerText = "Vă rugăm să completați numele pentru confirmare.";
        return;
      }
      if (!numberValue) {
        statusMsg.innerText = "Vă rugăm să completați numărul de persoane pentru confirmare.";
        return;
      }
      if (!userIp) {
        statusMsg.innerText = "Nu am putut detecta IP-ul dumneavoastră. Reîncercați.";
        return;
      }

      // Construct query: ?ip=1.2.3.4&name=...&number=...
      const url = `${APPS_SCRIPT_URL}?ip=${encodeURIComponent(userIp)}&name=${encodeURIComponent(nameValue)}&number=${encodeURIComponent(numberValue)}`;

      showLoading();
      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            localStorage.setItem('old_ip', userIp)
            statusMsg.innerText =
              `Mulțumim, ${nameValue}! Confirmare înregistrată cu ${numberValue} persoan${numberValue === "1" ? "ă" : "e"}.`;
          } else {
            statusMsg.innerText = `Eroare: ${data.error}`;
          }
        })
        .catch(err => {
          statusMsg.innerText = `A apărut o eroare la trimiterea RSVP: ${err.message}`;
        })
        .finally(() => {
          hideLoading(); // hide spinner after submission attempt finishes
        });
    }

    // ------- 5) Countdown Timer ------
    const targetDate = new Date('2025-06-07T00:00:00');
    function updateCountdown() {
      const now = new Date();
      const diffInSeconds = Math.floor((targetDate - now) / 1000);

      if (diffInSeconds >= 0) {
        const months = Math.floor(diffInSeconds / (30 * 24 * 60 * 60));
        const days = Math.floor((diffInSeconds % (30 * 24 * 60 * 60)) / (24 * 60 * 60));
        const hours = Math.floor((diffInSeconds % (24 * 60 * 60)) / (60 * 60));
        const minutes = Math.floor((diffInSeconds % (60 * 60)) / 60);
        const seconds = diffInSeconds % 60;

        const countdownElement = document.getElementById('countdown');
        if (countdownElement) {
          countdownElement.innerHTML = `
            <div style="font-size: 2rem; display: flex; flex-wrap: wrap; justify-content: center; align-items: center;">
              <div style="margin: 5px 10px;">${months} <span>luni</span></div>
              <div style="margin: 5px 10px;">${days} <span>zile</span></div>
              <div style="margin: 5px 10px;">${hours} <span>ore</span></div>
              <div style="margin: 5px 10px">${minutes} <span>minute</span></div>
              <div style="margin: 5px 10px;">${seconds} <span>secunde</span></div>
            </div>
          `;
        }
      } else {
        if (document.getElementById('countdown')) {
          document.getElementById('countdown').textContent = 'The target date has passed!';
        }
      }
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();
  </script>

</body>
</html>
